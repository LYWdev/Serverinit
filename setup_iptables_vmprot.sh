#!/bin/bash

# 포워딩할 주소 및 포트 정보
declare -a info=(

"14041 192.168.10.11 22"
"14042 192.168.10.12 22"
"14043 192.168.10.13 22"
"14044 192.168.10.14 22"
"14045 192.168.10.15 22"
"14046 192.168.10.16 22"
"14047 192.168.10.17 22"
"14048 192.168.10.18 22"
"14049 192.168.10.19 22"
"14050 192.168.10.20 22"
"16041 192.168.10.51 22"
"16042 192.168.10.52 22"
"16043 192.168.10.53 22"
"16044 192.168.10.54 22"
"16045 192.168.10.55 22"
"16046 192.168.10.56 22"
"16047 192.168.10.57 22"
"16048 192.168.10.58 22"
"16049 192.168.10.59 22"
"16050 192.168.10.60 22"
"16384 192.168.10.10 22"
"20041 192.168.10.71 22"
"20042 192.168.10.72 22"
"20043 192.168.10.73 22"
"20044 192.168.10.74 22"
"20045 192.168.10.75 22"
"20046 192.168.10.76 22"
"20047 192.168.10.77 22"
"20048 192.168.10.78 22"
"20049 192.168.10.79 22"
"20050 192.168.10.80 22"

)

# 각각의 정보에 대해 포워딩 규칙 설정
for i in "${info[@]}"
do
    set -- $i
    in_port=$1
    out_ip=$2
    out_port=$3

    iptables -I INPUT -p tcp -s 155.230.0.0/16 -d 155.230.91.207 --dport $in_port -j ACCEPT
    iptables -I FORWARD -m tcp -p tcp -d $out_ip --dport $out_port -j ACCEPT
    iptables -I FORWARD -m state -p tcp -d 155.230.0.0/16 --state NEW,RELATED,ESTABLISHED -j ACCEPT
    iptables -t nat -I PREROUTING -p tcp -d 155.230.91.207 --dport $in_port -j DNAT --to-destination $out_ip:$out_port
done

